.PHONY: help dev build start test test-watch test-coverage test-ui lint lint-fix format type-check clean db-push db-studio db-seed db-migrate db-migrate-run db-generate

# Default target
help: ## Show available commands
	@echo "API - Available commands:"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'
	@echo ""

# Development
dev: ## Start API dev server (with watch)
	@echo "ğŸš€ Starting API dev server..."
	@pnpm exec tsx watch --env-file=.env src/index.ts

build: ## Build for production
	@echo "ğŸ—ï¸  Building for production..."
	@pnpm exec tsc

start: ## Start production server
	@echo "ğŸš€ Starting production server..."
	@node --env-file=.env dist/index.js

clean: ## Clean build artifacts
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@rm -rf dist node_modules/.vite

# Testing
test: ## Run tests
	@echo "ğŸ§ª Running tests..."
	@pnpm exec vitest run

test-watch: ## Run tests in watch mode
	@echo "ğŸ§ª Running tests in watch mode..."
	@pnpm exec vitest

test-coverage: ## Run tests with coverage
	@echo "ğŸ“Š Running tests with coverage..."
	@pnpm exec vitest run --coverage

test-ui: ## Run tests with UI
	@echo "ğŸ¨ Opening Vitest UI..."
	@pnpm exec vitest --ui

# Database
db-push: ## Push schema changes to database
	@echo "ğŸ—„ï¸  Pushing schema to database..."
	@pnpm exec drizzle-kit push

db-studio: ## Open Drizzle Studio (database GUI)
	@echo "ğŸ¨ Opening Drizzle Studio..."
	@pnpm exec drizzle-kit studio

db-seed: ## Seed database with SUPER_ADMIN
	@echo "ğŸŒ± Seeding database..."
	@pnpm exec tsx --env-file=.env src/scripts/seed-super-admin.ts

db-migrate: ## Generate migration files
	@echo "ğŸ“ Generating migration..."
	@pnpm exec drizzle-kit migrate

db-migrate-run: ## Run migrations (with .env)
	@echo "ğŸš€ Running migrations..."
	@pnpm exec tsx --env-file=.env src/scripts/run-migrations.ts

db-generate: ## Generate migration from schema
	@echo "ğŸ“ Generating migration from schema..."
	@pnpm exec drizzle-kit generate

# Code Quality
lint: ## Lint code
	@echo "ğŸ” Linting code..."
	@pnpm exec biome check .

lint-fix: ## Lint and fix code
	@echo "ğŸ”§ Linting and fixing code..."
	@pnpm exec biome check --write .

format: ## Format code
	@echo "ğŸ’… Formatting code..."
	@pnpm exec biome format --write .

type-check: ## Run TypeScript type checking
	@echo "ğŸ“˜ Type checking..."
	@pnpm exec tsc --noEmit

# Shortcuts
tw: test-watch ## Alias for test-watch
